{% extends "base.html" %}

{% block title %}
    日記リスト - {{ block.super }}
{% endblock %}

{% block header_h1 %}
{#    <br>#}
    日記リスト
{% endblock %}

{% block breadcrumb %}
{#    <nav aria-label="breadcrumb">#}
{#        <ol class="breadcrumb">#}
{#            <li class="breadcrumb-item" aria-current="page"><a href="{% url 'diary:index' %}">ホーム</a></li>#}
{#            <li class="breadcrumb-item active" aria-current="page">日記一覧</li>#}
{#        </ol>#}
{#    </nav>#}
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">育児日記</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link" aria-current="page" href="{% url 'diary:index' %}"><i class="fas fa-home"></i> ホーム</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" active　href="{% url 'diary:diary_list' %}"><i class="fas fa-book"></i> 日記一覧</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

{% endblock %}

{% block main_content %}
{#    <hr>#}
    <div class="my-3">
        <a href="{% url 'diary:diary_create' %}" class="btn btn-success">新規作成</a>
    </div>
            <h1>{{ tag.name }}</h1>

    <form method="GET" action="{% url 'diary:diary_list' %}"  >
{#        <label for="tag"></label>#}
{#        <select name="tag" id="tag" class="form-control" title="タグを選択してください">#}
{#            <option value="">すべて</option>#}
{#            {% for tag in tags %}#}
{#                <option value="{{ tag.slug }}"#}
{#                        {% if tag.slug == selected_tag %} selected {% endif %}>#}
{#                    {{ tag.name }}#}
{#                </option>#}
{#            {% endfor %}#}
{#        </select>#}
{#        <select name="num_diaries" id="num_diaries" class="form-control" title="各ページに表示する日記の数を選んでください">#}
{#            <option value="6" {% if num_diaries == '6' %} selected {% endif %}>6</option>#}
{#            <option value="8" {% if num_diaries == '8' %} selected {% endif %}>8</option>#}
{#            <option value="10" {% if num_diaries == '10' %} selected {% endif %}>10</option>#}
{#            <option value="20" {% if num_diaries == '20' %} selected {% endif %}>20</option>#}
{#            <option value="30" {% if num_diaries == '30' %} selected {% endif %}>30</option>#}
{#            <option value="all" {% if num_diaries == 'all' %} selected {% endif %}>すべて</option>#}
{#        </select>#}
{#        <input type="text" name="keyword" value="{{ keyword }}" class="form-control">#}
{#        <button type="submit" class="btn btn-outline-success">Filter</button>#}
{#    <hr>#}
        <div class="form-row">
            <div class="form-group col-md-4">
                <label for="tag">タグ検索</label>
                <select name="tag" id="tag" class="form-control">
                    <option value="">すべて</option>
                    {% for tag in tags %}
                        <option value="{{ tag.slug }}"
                                {% if tag.slug == selected_tag %} selected {% endif %}>
                            {{ tag.name }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group col-md-4">
                <label for="num_diaries">1ページあたりの日記の表示数</label>
                <select name="num_diaries" id="num_diaries" class="form-control">
                    <option value="6" {% if num_diaries == '6' %} selected {% endif %}>6</option>
                    <option value="8" {% if num_diaries == '8' %} selected {% endif %}>8</option>
                    <option value="10" {% if num_diaries == '10' %} selected {% endif %}>10</option>
                    <option value="20" {% if num_diaries == '20' %} selected {% endif %}>20</option>
                    <option value="30" {% if num_diaries == '30' %} selected {% endif %}>30</option>
                    <option value="all" {% if num_diaries == 'all' %} selected {% endif %}>すべて</option>
                </select>
            </div>
            <div class="form-group col-md-4">
                <label for="keyword">キーワード検索</label>
                <input type="text" name="keyword" value="{{ keyword }}" class="form-control">
            </div>
        </div>
        <button type="submit" class="btn btn-primary"><i class="fas fa-search"></i></button>

    </form>
    <br>
    <div class="row row-cols-1 row-cols-md-2 g-4">

        {% for diary in diary_list %}

            <div class="col">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">{{ diary.title }}</h5>
                        {% if diary.thumbnail %}
                            <img src="{{ diary.thumbnail.url }}" class="img-fluid">
                        {% endif %}
{#                            {% if diary.thumbnail_video %}#}
{#                                <img src="{{ diary.thumbnail_video.url }}" class="img-fluid">#}
{#                            {% endif %}#}

                        <p class="card-text">{{ diary.text|truncatechars:50 }}</p>
                        <a href="{% url 'diary:diary_detail' diary.pk %}" class="btn btn-primary">詳細を見る</a>
                    </div>
                    <div class="card-footer">
                        <small class="text-muted">{{ diary.created_at|date:"Y年m月d日(D)" }} {{ diary.user }}</small>
                    </div>
                </div>
            </div>

        {% endfor %}
    </div>

    <br>
{#        <nav aria-label="Page navigation">#}
{#            <ul class="pagination pagination justify-content-center">#}
{#                <!-- 現在よりも前のページが存在する場合 -->#}
{#                {% if page_obj.has_previous %}#}
{#                    <li class="page-item"><a class="page-link" href="?page=1">&laquo; 先頭</a></li>#}
{#                    <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}">前へ</a></li>#}
{#                {% endif %}#}
{##}
{#                <!-- 数字の部分 -->#}
{#                {% for num in page_obj.paginator.page_range %}#}
{#                    {% if page_obj.number == num %}#}
{#                        <li class="page-item active"><span class="page-link">{{ num }}</span></li>#}
{#                    {% else %}#}
{#                        <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>#}
{#                    {% endif %}#}
{#                {% endfor %}#}
{##}
{#                <!-- 現在よりも後のページが存在する場合 -->#}
{#                {% if page_obj.has_next %}#}
{#                    <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">次へ</a></li>#}
{#                    <li class="page-item"><a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">最後 &raquo;</a></li>#}
{#                {% endif %}#}
{#            </ul>#}
{#        </nav>#}
    {% if is_paginated %}
        <nav aria-label="Page navigation">
          <ul class="pagination justify-content-center">
            {% if page_obj.has_previous %}
            <li class="page-item">
              <a class="page-link" href="?page=1{% if selected_tag %}&tag={{ selected_tag }}{% endif %}{% if keyword %}&keyword={{ keyword }}{% endif %}{% if num_diaries %}&num_diaries={{ num_diaries }}{% endif %}" aria-label="first">
                &laquo;
              </a>
            </li>
            <li class="page-item">
              <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if selected_tag %}&tag={{ selected_tag }}{% endif %}{% if keyword %}&keyword={{ keyword }}{% endif %}{% if num_diaries %}&num_diaries={{ num_diaries }}{% endif %}" aria-label="previous">
                &lsaquo;
              </a>
            </li>
            {% endif %}

            {% for page_num in page_obj.paginator.page_range %}
              {% if page_obj.number == page_num %}
              <li class="page-item active">
                <span class="page-link">{{ page_num }}<span class="sr-only">(current)</span></span>
              </li>
              {% else %}
              <li class="page-item">
                <a class="page-link" href="?page={{ page_num }}{% if selected_tag %}&tag={{ selected_tag }}{% endif %}{% if keyword %}&keyword={{ keyword }}{% endif %}{% if num_diaries %}&num_diaries={{ num_diaries }}{% endif %}">
                  {{ page_num }}
                </a>
              </li>
              {% endif %}
            {% endfor %}

            {% if page_obj.has_next %}
            <li class="page-item">
              <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if selected_tag %}&tag={{ selected_tag }}{% endif %}{% if keyword %}&keyword={{ keyword }}{% endif %}{% if num_diaries %}&num_diaries={{ num_diaries }}{% endif %}" aria-label="next">
                &rsaquo;
              </a>
            </li>
            <li class="page-item">
              <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}{% if selected_tag %}&tag={{ selected_tag }}{% endif %}{% if keyword %}&keyword={{ keyword }}{% endif %}{% if num_diaries %}&num_diaries={{ num_diaries }}{% endif %}" aria-label="last">
                &raquo;
              </a>
            </li>
            {% endif %}
          </ul>
        </nav>
    {% endif %}

{#        <a href="{% url 'diary:index' %}">戻る</a>#}

{% endblock %}